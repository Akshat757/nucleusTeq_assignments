<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Order History</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/customer.css">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <a class="navbar-brand" href="customer-dashboard.html">Dashboard</a>
    <a class="nav-link" href="index.html">Logout</a>
</nav>
<div class="container mt-4">
    <h2>Order History</h2>
    <div id="orderHistoryContainer">
        <!-- Orders will be rendered here -->
    </div>
</div>
<!-- jQuery and Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        loadOrders();
    });

    async function loadOrders() {
        const user = JSON.parse(localStorage.getItem('user'));
        try {
            const res = await fetch(`http://localhost:8081/api/orders/customer/${user.id}`);
            const orders = await res.json();
            renderOrders(orders);
        } catch (err) {
            console.error("Error loading orders:", err);
        }
    }

    function renderOrders(orders) {
        const container = document.getElementById('orderHistoryContainer');
        container.innerHTML = '';
        orders.forEach(order => {
            const orderDiv = document.createElement('div');
            orderDiv.className = 'card mb-3';
            let detailsHtml = '';
            if (order.orderDetails && order.orderDetails.length > 0) {
                detailsHtml = '<ul class="list-group list-group-flush">';
                order.orderDetails.forEach(detail => {
                    detailsHtml += `<li class="list-group-item">
                              ${detail.menuItem.name} - $${detail.price.toFixed(2)} (x${detail.quantity})
                            </li>`;
                });
                detailsHtml += '</ul>';
            }
            orderDiv.innerHTML = `
          <div class="card-body">
            <h5 class="card-title">Order #${order.id}</h5>
            <p class="card-text">Total: $${order.total.toFixed(2)}</p>
            <p class="card-text">Status: ${order.status}</p>
            <p class="card-text">Order Date: ${new Date(order.orderDate).toLocaleString()}</p>
            <p class="card-text">Remaining Wallet Balance: $${order.remainingWalletBalance || 'N/A'}</p>
            ${detailsHtml}
          </div>
        `;
            container.appendChild(orderDiv);
        });
    }
</script>
</body>
</html>
